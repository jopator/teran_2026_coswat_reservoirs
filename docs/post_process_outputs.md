# Processing CoSWAT Outputs

This section describes how to process simulation outputs generated by CoSWAT.
The processing step converts raw SWAT+ outputs into structured time series datasets used for validation and analysis.

Processing is performed using the scripts located in the `Scripts/result_analysis/` directory.

To run this script, you must have completed the [model setup](Setting_up_CoswatFramework.md) and [executed the simulations](running_sims.md).

---

## Directory Structure

```
Scripts/result_analysis/
└── reservoirs_coswat
    ├── data_processing
    │   ├── process_out_coswat_reservoirs.py
    │   ├── process_out_coswat_streamflow.py
    │   ├── read_swat.py
    │   ├── run_process.py
    │   └── run_process.sh
    ├── validation
    ├── isimipModels
    └── others
```

---

## data_processing/

The `data_processing/` directory contains the scripts required to extract, filter, and structure simulation outputs.

These scripts generate serialized time series files (pickle format) for:

* Reservoir storage, inflow, and outflow
* Channel streamflow
* Associated observational datasets (where applicable)

These processed outputs are used in the validation and analysis steps described in subsequent sections.

---

### process_out_coswat_reservoirs.py

Processes reservoir-related outputs from SWAT+ simulations.

Extracted variables include:

* Storage
* Inflow
* Outflow

The script produces one processed time series file per region.

Arguments are `--r <region> --v <version>`

Example:

```bash
python3 process_out_coswat_reservoirs.py --r africa-nile --v 1.5.0
```

---

### process_out_coswat_streamflow.py

Processes channel flow outputs and matches them with observations from the Global Runoff Data Centre (GRDC).

GRDC data portal:
[https://grdc.bafg.de/data/data_portal/](https://grdc.bafg.de/data/data_portal/)

This script:

* Extracts simulated streamflow from SWAT+ outputs
* Matches simulation locations with observation stations
* Produces processed time series per region

This requires GRDC data for each region, provided in [Teran(2026)](https://doi.org/10.5281/zenodo.18733431), available in `model-data/<region>/observations`.


Arguments are `--r <region> --v <version>`

Example:

```bash
python3 process_out_coswat_streamflow.py --r africa-nile --v 1.5.0
```

---

### run_process.py

This is a utility script that can be run to perform post-processing of model outputs for more than one region using parallel processing. It will internally run the two scripts mentioned above.

Example:

```bash
python3 run_process.py
```

---

### run_process.sh

Batch script for submission on HPC systems.

This script executes `run_process.py` scheduled as a slurm job.

Example:

```bash
sbatch run_process.sh
```

---

## Expected Output

If processing is successful, structured time series files (pickle format) will be created at `Scripts/result_analysis/reservoirs_coswat/coswat_outputs`.

These files are used in:

* Validation of reservoir performance
* Validation of streamflow
* Comparative analysis with other global models
